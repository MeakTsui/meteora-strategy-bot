# 查询脚本使用说明

## queryPosition.ts - 查询钱包仓位和手续费信息

### 功能说明
该脚本用于查询指定钱包在 Meteora DLMM 池中的所有仓位信息，包括：
- 仓位地址和所有者
- 流动性分布（各个 Bin 的详细信息）
- Bin ID 范围
- Token X 和 Token Y 的数量
- 仓位原始数据（用于调试）

### 使用方法

#### 1. 配置环境变量
确保 `.env` 文件中配置了以下参数：

**方式一：使用私钥（Base58 格式）**
```bash
# RPC 节点地址
RPC_URL=https://api.mainnet-beta.solana.com

# 钱包私钥（Base58 格式）
WALLET_PRIVATE_KEY=your_private_key_here
```

**方式二：使用助记词**
```bash
# RPC 节点地址
RPC_URL=https://api.mainnet-beta.solana.com

# 钱包助记词（12 或 24 个单词，用空格分隔）
WALLET_MNEMONIC="word1 word2 word3 ... word12"
```

> 注意：脚本会自动检测您使用的是私钥还是助记词格式

#### 2. 运行脚本

**使用默认池地址查询：**
```bash
npm run query
```

**查询指定池地址：**
```bash
npm run query -- <池地址>
```

或者直接使用 ts-node：
```bash
ts-node src/scripts/queryPosition.ts <池地址>
```

### 示例

```bash
# 查询默认 SOL-USDC 池
npm run query

# 查询指定池地址
npm run query -- LBUZKhRxPF3XUpBCjp4YzTKgLccjZhTSDM9YuVaPwxo
```

### 输出示例

```
================================================================================
🔍 开始查询仓位信息
================================================================================

📍 RPC 节点: https://api.mainnet-beta.solana.com
💼 钱包地址: YourWalletAddressHere...
🏊 池地址: LBUZKhRxPF3XUpBCjp4YzTKgLccjZhTSDM9YuVaPwxo

📊 池信息:
   Token X: So11111111111111111111111111111111111111112
   Token Y: EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v
   Bin Step: 25
   当前活跃 Bin ID: 12345
   当前价格: 150.25

================================================================================
📦 查询用户仓位...
================================================================================

✅ 找到 2 个仓位

────────────────────────────────────────────────────────────────────────────────
📍 仓位 #1
────────────────────────────────────────────────────────────────────────────────
   仓位地址: PositionPublicKeyHere...
   所有者: YourWalletAddressHere...

💰 流动性信息:
   总 Bin 数量: 5
   Bin ID 范围: 12340 - 12350

   📊 各 Bin 详情:
      Bin 1:
         Bin ID: 12340
         Token X 数量: 1000000000
         Token Y 数量: 150000000

💵 手续费和奖励信息:
   ℹ️  手续费会在移除流动性时自动领取
   ℹ️  可以通过 claimLMReward 方法领取奖励

================================================================================
✅ 查询完成
================================================================================
```

### 注意事项

1. **密钥安全**：请妥善保管您的私钥/助记词，不要将包含密钥的 `.env` 文件提交到版本控制系统
2. **助记词派生路径**：脚本使用 Solana 标准派生路径 `m/44'/501'/0'/0'`，与 Phantom、Solflare 等主流钱包一致
3. **RPC 限制**：使用公共 RPC 节点可能有速率限制，建议使用付费 RPC 服务
4. **网络延迟**：查询速度取决于 RPC 节点的响应速度
5. **数量单位**：显示的 Token 数量为原始单位（未除以 decimals），需要根据 Token 的 decimals 进行换算

### 常见问题

**Q: 提示"未找到任何仓位"怎么办？**
A: 请确认：
- 钱包地址是否正确
- 该钱包在指定池中是否真的有仓位
- 池地址是否正确

**Q: 如何获取池地址？**
A: 可以通过以下方式获取：
- Meteora 官方网站查看
- 使用 Meteora API 查询
- 从区块链浏览器获取

**Q: 手续费信息为什么显示不完整？**
A: 手续费数据在 Meteora DLMM 中会在移除流动性时自动领取，脚本显示的是仓位的原始数据结构。

**Q: 使用助记词时钱包地址不对怎么办？**
A: 
- 确认助记词是否正确（12 或 24 个单词）
- 脚本使用的是标准派生路径 `m/44'/501'/0'/0'`
- 如果您的钱包使用了不同的派生路径，可能需要修改脚本中的路径
- 可以在脚本输出的钱包地址处确认是否与您的钱包地址一致
